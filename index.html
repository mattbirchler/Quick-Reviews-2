<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Meta Tags -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Page Title -->
  <title>Quick Reviews</title>

  <!-- PWA/App Icons -->
  <link rel="manifest" href="/manifest.json">
  <link rel="shortcut icon" href="icon@512.png" type="image/x-icon">
  <link rel="apple-touch-icon" href="icon@512.png">
  <link rel="apple-touch-startup-image" href="splash.png">

  <!-- Stylesheets -->
  <link rel="stylesheet" href="style.css?v=2.8.6">
  <link rel="stylesheet" href="transition.css">
  <link rel="stylesheet" href="animate.min.css">

  <!-- External Libraries -->
  <script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
  ></script>
  <script src="https://cdn.jsdelivr.net/npm/party-js@latest/bundle/party.min.js"></script>

  <!-- Local Scripts -->
  <script src="html2canvas.js"></script>
  <script src="scripts/modal.js"></script>
  <script src="scripts/poster.js"></script>
  <script src="scripts/tinycolor.js"></script>
  <script src="scripts/should-i-animate.js"></script>
  <script src="scripts/alert.js"></script>
  <script src="scripts/poster-placeholder.js"></script>
  <script src="scripts/themes.js"></script>

  <!-- Analytics & Verification -->
  <script defer data-domain="quickreviews.app" src="https://plausible.io/js/script.js"></script>
  <a rel="me" href="https://isfeeling.social/@matt" style="display: none">Mastodon</a>
</head>

<body>
  <!-- New iOS banner added for one-time appearance -->
  <div id="ios-banner" class="ios-banner">
    <span class="ios-banner-icon">ðŸ“±</span>
    <span>Quick Reviews is now on iOS!</span>
    <a href="https://apps.apple.com/us/app/quick-reviews/id6740369719?ref=quickreviews.app" target="_blank" class="ios-banner-link">Get the app</a>
    <button id="close-ios-banner" class="ios-banner-close" aria-label="Dismiss">Ã—</button>
  </div>

  <div id="background_image"></div>

  <div id="site_name">
    <h1 aria-label="Quick Reviews">
      <a id="site_title" href="https://quickreviews.app">
        <span class="animate__animated" style="opacity: 0; animation-duration: 0.6s; animation-delay: 0.6s">Q</span>
        <span class="animate__animated" style="opacity: 0; animation-duration: 0.6s; animation-delay: 0.65s">u</span>
        <span class="animate__animated" style="opacity: 0; animation-duration: 0.6s; animation-delay: 0.7s">i</span>
        <span class="animate__animated" style="opacity: 0; animation-duration: 0.6s; animation-delay: 0.75s">c</span>
        <span class="animate__animated" style="opacity: 0; animation-duration: 0.6s; animation-delay: 0.8s">k</span>
        <span class="animate__animated" style="opacity: 0; animation-duration: 0.6s; animation-delay: 0.85s">&nbsp;</span>
        <span class="animate__animated" style="opacity: 0; animation-duration: 0.6s; animation-delay: 0.9s">R</span>
        <span class="animate__animated" style="opacity: 0; animation-duration: 0.6s; animation-delay: 0.95s">e</span>
        <span class="animate__animated" style="opacity: 0; animation-duration: 0.6s; animation-delay: 1.0s">v</span>
        <span class="animate__animated" style="opacity: 0; animation-duration: 0.6s; animation-delay: 1.05s">i</span>
        <span class="animate__animated" style="opacity: 0; animation-duration: 0.6s; animation-delay: 1.1s">e</span>
        <span class="animate__animated" style="opacity: 0; animation-duration: 0.6s; animation-delay: 1.15s">w</span>
        <span class="animate__animated" style="opacity: 0; animation-duration: 0.6s; animation-delay: 1.2s">s</span>
      </a>
    </h1>
    <div id="underline"></div>
  </div>

  <button
    class="skip-to-content"
    onclick="document.getElementById('image-uploader').focus()"
    aria-label="Skip theme selection">
    Skip to review
  </button>

  <section class="themes-section" role="group" aria-label="Theme selection">
    <div class="themes-row" id="theme_list">
      <button class="theme-dot" id="theme_1" aria-label="Home theme - Dark blue" title="Home" style="background-color: #2B384F"></button>
      <button class="theme-dot" id="theme_2" aria-label="Ice theme - Light gray" title="Ice" style="background-color: #F3F6FF"></button>
      <button class="theme-dot" id="theme_3" aria-label="Pink heart theme - Bright pink" title="Pink" style="background-color: #E70CDF"></button>
      <button class="theme-dot" id="theme_4" aria-label="Blueberry theme - Light blue" title="Blueberry" style="background-color: #13BDFF"></button>
      <button class="theme-dot" id="theme_5" aria-label="Bee theme - Yellow" title="Bee" style="background-color: #FEBF00"></button>
      <button class="theme-dot" id="theme_6" aria-label="Candy theme - Deep purple" title="Candy" style="background-color: #3B0C95"></button>
      <button class="theme-dot" id="theme_7" aria-label="Ocean theme - Turquoise" title="Ocean" style="background-color: #1FCBE2"></button>
      <button class="theme-dot" id="theme_8" aria-label="Blood theme - Red" title="Blood" style="background-color: #E5322F"></button>
      <button class="theme-dot" id="theme_9" aria-label="Peach theme - Salmon pink" title="Peach" style="background-color: #EE9882"></button>
      <button class="theme-dot" id="theme_10" aria-label="Forest theme - Dark green" title="Forest" style="background-color: #38571A"></button>
    </div>
  </section>

  <!-- <div id="shortcut_key">
    <div class="example_shortcut command_shortcut clickable_shortcut" id="open_command_palette">
      <div class="the_description">Commands (&#8984;+K)</div>
    </div>
  </div> -->

  <!-- <div id="helper">Click anywhere on the review to edit</div> -->

  <div class="review-container">
    <div id="review">
      <div id="top">
        <div id="poster" role="region" aria-label="Poster image upload area">
          <input
            type="file"
            id="image-uploader"
            accept="image/*"
            aria-label="Upload poster image"
            tabindex="0">
        </div>

        <div id="review_text" tabindex="0" role="region" aria-labelledby="review text">
          <div id="title">
            The Title Goes Here
          </div>
          <div id="meta">
            2024 - Director Name
          </div>
          <div id="text">
            This is the review text. It can be as long as you want it to be. You can also use line breaks to make it look nice.
          </div>
        </div>

      </div>

      <script>
        document.getElementById('review_text').addEventListener('keydown', function (event) {
          if (event.key === 'Enter' || event.key === ' ') {
            event.preventDefault(); // Prevent default behavior for the Space key
            this.click(); // Simulate a click
          }
        });
      </script>

      <div id="bottom" role="radiogroup" aria-label="Rate your experience">
      <div 
        class="score animate__animated" 
        id="poor"
        role="radio"
        tabindex="0"
        aria-checked="false"
        aria-label="Rate as: Didn't Like It"
        onkeypress="if(event.key === 'Enter') this.click()">
        Didn't Like It
      </div>
      <div 
        class="score animate__animated" 
        id="solid"
        role="radio"
        tabindex="0"
        aria-checked="false"
        aria-label="Rate as: Decent"
        onkeypress="if(event.key === 'Enter') this.click()">
        Decent
      </div>
      <div 
        class="score animate__animated" 
        id="good"
        role="radio"
        tabindex="0"
        aria-checked="false"
        aria-label="Rate as: Liked It"
        onkeypress="if(event.key === 'Enter') this.click()">
        Liked It
      </div>
      <div 
        class="score animate__animated" 
        id="great"
        role="radio"
        tabindex="0"
        aria-checked="false"
        aria-label="Rate as: Loved It"
        onkeypress="if(event.key === 'Enter') this.click()"
        onclick="party.confetti(this);">
        Loved It!
      </div>
    </div>
  </div>
  </div>

  <div class="text-size-slider" aria-label="Adjust review text size">
    <div class="slider-hints">
      <span class="hint-small">A</span>
    </div>
    <div class="slider-track">
      <input
        type="range"
        id="text_size_slider"
        class="horizontal-slider"
        min="8"
        max="60"
        value="26"
        aria-label="Review text size">
    </div>
    <div class="slider-hints">
      <span class="hint-large">A</span>
    </div>
    <div class="slider-value" id="slider_value_display">26<span class="slider-unit">px</span></div>
  </div>

  <div id="buttons">
    <button class="btn" id="edit_title">Edit (âŒ˜+E)</button>
    <button class="btn animate__animated" id="save_the_image" role="button" onclick="exportImageShortcut();">Save</button>
  </div>



  <section class="customize-section">
    <div class="customize-header">
      <h2 class="customize-title">Customize</h2>
      <p class="customize-subtitle">Fine-tune your review card's appearance</p>
    </div>

    <div class="customize-panels">
      <!-- Colors Panel -->
      <div class="panel" id="colors-panel">
        <div class="panel-header">
          <div class="panel-title-row">
            <svg class="panel-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <path d="M12 2a10 10 0 0 1 0 20"/>
            </svg>
            <h3 class="panel-title">Colors</h3>
          </div>
          <button class="panel-reset" id="reset_colors_button" aria-label="Reset colors">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
              <path d="M3 3v5h5"/>
            </svg>
            Reset
          </button>
        </div>
        <div class="panel-content">
          <div class="color-grid">
            <div class="color-item color-item-large">
              <label class="color-label">Background</label>
              <div class="color-input-wrap">
                <input type="color" class="color_picker" id="background_color" value="#e9eef1" />
                <span class="color-value" id="background_color_value">#e9eef1</span>
              </div>
            </div>
            <div class="color-row">
              <div class="color-item">
                <label class="color-label">Bad</label>
                <input type="color" class="color_picker color-small" id="poor_color" value="#F28482" />
              </div>
              <div class="color-item">
                <label class="color-label">Okay</label>
                <input type="color" class="color_picker color-small" id="okay_color" value="#F6BD60" />
              </div>
              <div class="color-item">
                <label class="color-label">Good</label>
                <input type="color" class="color_picker color-small" id="good_color" value="#A4BBF4" />
              </div>
              <div class="color-item">
                <label class="color-label">Great</label>
                <input type="color" class="color_picker color-small" id="great_color" value="#05CC9E" />
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Typography Panel -->
      <div class="panel" id="typography-panel">
        <div class="panel-header">
          <div class="panel-title-row">
            <svg class="panel-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="4 7 4 4 20 4 20 7"/>
              <line x1="9" y1="20" x2="15" y2="20"/>
              <line x1="12" y1="4" x2="12" y2="20"/>
            </svg>
            <h3 class="panel-title">Typography</h3>
          </div>
          <button class="panel-reset" id="reset_font_size_button" aria-label="Reset font sizes">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
              <path d="M3 3v5h5"/>
            </svg>
            Reset
          </button>
        </div>
        <div class="panel-content">
          <div class="size-controls">
            <div class="size-item">
              <label class="size-label">Title</label>
              <div class="size-input-group">
                <button class="size-btn size-decrease" data-target="text_size_title">âˆ’</button>
                <input type="number" class="size-input" id="text_size_title" value="48" min="8" max="120" />
                <button class="size-btn size-increase" data-target="text_size_title">+</button>
                <span class="size-unit">px</span>
              </div>
            </div>
            <div class="size-item">
              <label class="size-label">Metadata</label>
              <div class="size-input-group">
                <button class="size-btn size-decrease" data-target="text_size_metadata">âˆ’</button>
                <input type="number" class="size-input" id="text_size_metadata" value="28" min="8" max="80" />
                <button class="size-btn size-increase" data-target="text_size_metadata">+</button>
                <span class="size-unit">px</span>
              </div>
            </div>
            <div class="size-item">
              <label class="size-label">Body</label>
              <div class="size-input-group">
                <button class="size-btn size-decrease" data-target="text_size_review">âˆ’</button>
                <input type="number" class="size-input" id="text_size_review" value="26" min="8" max="60" />
                <button class="size-btn size-increase" data-target="text_size_review">+</button>
                <span class="size-unit">px</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Score Labels Panel -->
      <div class="panel" id="labels-panel">
        <div class="panel-header">
          <div class="panel-title-row">
            <svg class="panel-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 20h9"/>
              <path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"/>
            </svg>
            <h3 class="panel-title">Score Labels</h3>
          </div>
          <button class="panel-reset" id="reset_score_names_button" aria-label="Reset score names">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
              <path d="M3 3v5h5"/>
            </svg>
            Reset
          </button>
        </div>
        <div class="panel-content">
          <div class="label-grid">
            <div class="label-item">
              <span class="label-indicator" style="background: var(--score-bad, #F28482)"></span>
              <input type="text" class="label-input" id="score_1" placeholder="Didn't Like It">
            </div>
            <div class="label-item">
              <span class="label-indicator" style="background: var(--score-okay, #F6BD60)"></span>
              <input type="text" class="label-input" id="score_2" placeholder="Decent">
            </div>
            <div class="label-item">
              <span class="label-indicator" style="background: var(--score-good, #A4BBF4)"></span>
              <input type="text" class="label-input" id="score_3" placeholder="Liked It">
            </div>
            <div class="label-item">
              <span class="label-indicator" style="background: var(--score-great, #05CC9E)"></span>
              <input type="text" class="label-input" id="score_4" placeholder="Loved It!">
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="alt-layout-notice">
    <span class="alt-layout-icon">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="3" width="18" height="18" rx="2"/>
        <path d="M9 3v18"/>
        <path d="M3 9h6"/>
      </svg>
    </span>
    <span>Reviewing music? Try the <a href="square.html">square art layout</a></span>
  </div>

  <footer class="site-footer">
    <div class="footer-content">
      <div class="footer-brand">
        <div class="footer-logo">QR</div>
        <div class="footer-tagline">Quick Reviews</div>
      </div>

      <div class="footer-grid">
        <div class="footer-section">
          <h4 class="footer-heading">Download</h4>
          <a href="https://apps.apple.com/us/app/quick-reviews/id6740369719?ref=quickreviews.app" target="_blank" class="app-store-link">
            <img src="app-store.svg" alt="Download on the App Store" height="36">
          </a>
        </div>

        <div class="footer-section">
          <h4 class="footer-heading">Creator</h4>
          <div class="footer-links">
            <a href="https://birchtree.me" target="_blank">Birchtree</a>
            <a href="https://www.youtube.com/@ABetterComputer" target="_blank">A Better Computer</a>
            <a href="https://letterboxd.com/mattbirchler/" target="_blank">Letterboxd</a>
          </div>
        </div>

        <div class="footer-section">
          <h4 class="footer-heading">Connect</h4>
          <div class="footer-links">
            <a href="https://bsky.app/profile/birchtree.me" target="_blank">Bluesky</a>
            <a href="https://isfeeling.social/@matt" target="_blank">Mastodon</a>
            <a href="mailto:matt@birchtree.me">Email</a>
          </div>
        </div>

        <div class="footer-section">
          <h4 class="footer-heading">Legal</h4>
          <div class="footer-links">
            <a href="privacy.html" target="_blank">Privacy Policy</a>
          </div>
        </div>
      </div>

      <div class="footer-bottom">
        <p class="footer-privacy">
          Your data stays private. All review content is stored locally in your browser - we never see it.
        </p>
        <p class="footer-credit">
          Made with care by <a href="https://birchtree.me" target="_blank">Matt Birchler</a>
        </p>
      </div>
    </div>
  </footer>

</body>

<div id="modal" class="modal">
  <div class="modal-content">
    <input type="text" class="modal_input" id="modal_text_title" placeholder="Media title">
    <input type="text" class="modal_input" id="modal_text_meta" placeholder="YYYY - Director Name">
    <textarea id="modal_text_text" cols="48" rows="8" placeholder="Write your review..."></textarea>
    <!-- <input type="text" class="modal_input" id="modal_text_text" placeholder="Your review goes here"> -->
    <button class="btn" id="close_modal" onclick="saveData()">Save (âŒ˜+Enter)</button>
  </div>
</div>

<div id="alert">
  <span>Your image is too large to save to localStorage. Your review will export perfectly, but your uploaded image won't be here on your next visit.</span>
  <img class="alert_close" id="alert_close" src="close-yellow.png">
</div>

<div id="alert_clipboard">
  <span>Review text copied</span>
  <!-- <img class="alert_close" id="clipboard_close" src="close-yellow.png"> -->
</div>

<script>
  // Alert listener here

  $("#alert_close").click(function() {
    $("#alert").css("display", "none");
  });
</script>

<!-- Icons here https://ionic.io/ionicons/usage -->
<script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

</html>

<!-- Adding scripts that look for items in the DOM -->
<script src="scripts/keyboard.js?v=1.0.1"></script>


<script>

function exportDivAsPNG() {
  const remoteImage = document.getElementById('poster');

  // Using a free CORS proxy to bypass CORS restrictions
  const corsProxy = 'https://cors-anywhere.herokuapp.com/';
  const imageUrl = remoteImage.src;

  remoteImage.src = `${corsProxy}${imageUrl}`;

  // Get the div element by its ID
  // $("#review").css("display", "block");
  const divElement = document.getElementById("review");

  $("#save_the_image").addClass("animate__pulse");
  $("#save_the_image").delay(1000).queue(function() {
    // Code to execute after the pause
    $("#save_the_image").removeClass("animate__pulse");
    $(this).dequeue();
  });

  if ($(window).width() < 600) {
    renderScale = 9;
  } else {
    renderScale = 3;
  }

  // Use html2canvas to capture the content of the div with additional options
  // html2canvas(divElement, {
  //   scale: renderScale, // Increase the scale to improve the image quality
  //   useCORS: true, // Enable CORS to load external resources, if any
  //   allowTaint: true, // Allow cross-origin images to taint the canvas
  //   logging: true, // Disable logging
  //   backgroundColor: null, // Set the background color to transparent
  //   letterRendering: true, // Improve the rendering of letters
  // }).then(canvas => {
  //   // Create an anchor element to trigger the download
  //   const link = document.createElement('a');

  //   // Convert the canvas to a Blob object
  //   canvas.toBlob(blob => {
  //     // Create an object URL from the Blob object
  //     const url = URL.createObjectURL(blob);

  //     // Set the anchor properties for download
  //     link.href = url;
  //     link.download = "review.png";

  //     // Add the anchor to the DOM, trigger the click event, and remove it
  //     document.body.appendChild(link);
  //     link.click();
  //     document.body.removeChild(link);
  //   });
  // });

  html2canvas(divElement, {
  scale: renderScale, // Increase the scale to improve the image quality
  useCORS: true, // Enable CORS to load external resources, if any
  allowTaint: true, // Allow cross-origin images to taint the canvas
  logging: true, // Disable logging
  backgroundColor: null, // Set the background color to transparent
  letterRendering: true, // Improve the rendering of letters
}).then(canvas => {
  // Convert the canvas to a Blob object
  canvas.toBlob(blob => {
    // Create a file from the Blob object
    const file = new File([blob], 'review.png', { type: 'image/png' });

    // Create a share data object
    const shareData = {
      files: [file],
      title: 'Review Image',
      text: 'Check out this review image!',
    };

    // Copy the desired text to the clipboard
    var clipboardReviewScore = localStorage.getItem("score");
    if (clipboardReviewScore == 1) {
      var clipboardReviewText = localStorage.getItem("quick_score_1");
    } else if (clipboardReviewScore == 2) {
      var clipboardReviewText = localStorage.getItem("quick_score_2");
    } else if (clipboardReviewScore == 3) {
      var clipboardReviewText = localStorage.getItem("quick_score_3");
    } else if (clipboardReviewScore == 4) {
      var clipboardReviewText = localStorage.getItem("quick_score_4");
    }

    const textToCopy = localStorage.getItem("media_review");
    copyToClipboard(textToCopy);

    // Add the text as metadata to the image file
    // const reader = new FileReader();
    //   reader.onloadend = function () {
    //     const arrayBuffer = reader.result;
    //     const uint8Array = new Uint8Array(arrayBuffer);
    //     const blob = new Blob([uint8Array], { type: 'image/png' });
    //     const metadata = {
    //       type: 'text/plain',
    //       data: clipboardReviewText,
    //     };
    //     const files = [
    //       new File([blob], 'review.png', {
    //         type: 'image/png',
    //         lastModified: new Date().getTime(),
    //       }),
    //       new File([JSON.stringify(metadata)], 'metadata.json', {
    //         type: 'application/json',
    //         lastModified: new Date().getTime(),
    //       }),
    //     ];
    //     const shareDataWithMetadata = {
    //       files: files,
    //       title: 'Review Image',
    //       text: 'Check out this review image!',
    //     };
    //   }

    // Check if iOS or not
    // const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1) && !window.MSStream;

    // Check if the Web Share API is supported
    if (navigator.share && isIOS) {
      // Trigger the iOS share sheet
      navigator.share(shareData)
        .then(() => console.log('Shared successfully'))
        .catch(error => console.error('Error sharing:', error));
    } else {
      // Fallback for browsers that don't support the Web Share API
      console.log('Web Share API not supported');
      // Create an anchor element to trigger the download
      const link = document.createElement('a');
      // Create an object URL from the Blob object
      const url = URL.createObjectURL(blob);

      // Set the anchor properties for download
      link.href = url;
      link.download = "review.png";

      // Add the anchor to the DOM, trigger the click event, and remove it
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
  });
});
  // $("#review").css("display", "none");
}

function exportImageShortcut() {
  exportDivAsPNG();
  showAlert("Saved");
}

function saveData() {
  var formattedReviewText = document.getElementById('modal_text_text').value.split("\n").join("<br/>");

  localStorage.setItem("media_title", $('#modal_text_title').val());
  localStorage.setItem("media_meta", $('#modal_text_meta').val());
  localStorage.setItem("media_review", formattedReviewText);
  $("#title").html(localStorage.getItem("media_title"));
  $("#meta").html(localStorage.getItem("media_meta"));
  $("#text").html(localStorage.getItem("media_review"));
}

// Copy something to the clipboard
function copyToClipboard(text) {
  const textarea = document.createElement('textarea');
  textarea.value = text;
  document.body.appendChild(textarea);
  textarea.select();
  document.execCommand('copy');
  document.body.removeChild(textarea);
}

// Setting the localStorage values on page load
$(document).ready(function () {
    // Pre-fill info
    if (localStorage.getItem("poster_image")) {
        $("#poster").css("background-image", localStorage.getItem("poster_image"));
    } else {
      localStorage.setItem("poster_image", placehodler_poster_image);
      $("#poster").css("background-image", localStorage.getItem("poster_image"));
    }
    if (localStorage.getItem("media_image")) {
        $("#image_url").val(localStorage.getItem("media_image"));
        var the_url = $("#image_url").val();
        $("#poster").attr("src", the_url);
    }
    if (localStorage.getItem("media_title")) {
        $("#title").html(localStorage.getItem("media_title"));
        $("#modal_text_title").val(localStorage.getItem("media_title"));
    } else {
        localStorage.setItem("media_title", "The Title Goes Here");
        $("#modal_text_title").val(localStorage.getItem("media_title"));
    }
    if (localStorage.getItem("media_meta")) {
        $("#meta").html(localStorage.getItem("media_meta"));
        $("#modal_text_meta").val(localStorage.getItem("media_meta"));
    } else {
        localStorage.setItem("media_meta", "2024 - Director Name");
        $("#modal_text_meta").val(localStorage.getItem("media_meta"));
    }
    if (localStorage.getItem("media_review")) {
        $("#text").html(localStorage.getItem("media_review"));
        $("#modal_text_text").val(localStorage.getItem("media_review"));
    } else {
        localStorage.setItem("media_review", "This is the review text. It can be as long as you want it to be. You can also use line breaks to make it look nice.");
        $("#modal_text_text").val(localStorage.getItem("media_review"));
    }
    if (localStorage.getItem("text_size_title")) {
        $("#title").css("font-size", localStorage.getItem("text_size_title") + "px");
        $("#text_size_title").val(localStorage.getItem("text_size_title"));
    } else if ($(window).width() < 600) {
      localStorage.setItem("text_size_title", "17");
    } else {
        localStorage.setItem("text_size_title", "48");
    }
    if (localStorage.getItem("text_size_metadata")) {
        $("#meta").css("font-size", localStorage.getItem("text_size_metadata") + "px");
        $("#text_size_metadata").val(localStorage.getItem("text_size_metadata"));
    } else if ($(window).width() < 600) {
      localStorage.setItem("text_size_metadata", "10");
    } else {
        localStorage.setItem("text_size_metadata", "32");
    }
    if (localStorage.getItem("text_size_review")) {
        $("#text").css("font-size", localStorage.getItem("text_size_review") + "px");
        $("#text_size_review").val(localStorage.getItem("text_size_review"));
    } else if ($(window).width() < 600) {
      localStorage.setItem("text_size_review", "9");
    } else {
        localStorage.setItem("text_size_review", "26");
    }
    if (localStorage.getItem("score") == "1") {
        $("#poor").trigger("click");
        $("#poor_mobile").trigger("click");
    } else if (localStorage.getItem("score") == "2") {
        $("#solid").trigger("click");
        $("#solid_mobile").trigger("click");
    } else if (localStorage.getItem("score") == "3") {
        $("#good").trigger("click");
        $("#good_mobile").trigger("click");
    } else if (localStorage.getItem("score") == "4") {
        $("#great").trigger("click");
        $("#great_mobile").trigger("click");
    }
    // Score names
    var score_one = localStorage.getItem("quick_score_1");
    var score_two = localStorage.getItem("quick_score_2");
    var score_three = localStorage.getItem("quick_score_3");
    var score_four = localStorage.getItem("quick_score_4");
    // Score colors
    var score_one_color = localStorage.getItem("quick_score_color_1");
    var score_two_color = localStorage.getItem("quick_score_color_2");
    var score_three_color = localStorage.getItem("quick_score_color_3");
    var score_four_color = localStorage.getItem("quick_score_color_4");
    // Background colors
    var container_background_color = localStorage.getItem(
        "container_background_color"
    );
    // Encouraging quote
    if (localStorage.getItem("quote") == "show") {
        $("#toggle_quote").html("Hide Quote");
    } else if (localStorage.getItem("quote") == "hide") {
        $("#end").css("display", "none");
        $("#toggle_quote").html("Show Quote");
    } else {
        localStorage.setItem("quote", "show");
        $("#toggle_quote").html("Hide Quote");
    }

    // Change text sizes
    $("#text_size_title").change(function () {
        var size = $("#text_size_title").val();
        localStorage.setItem("text_size_title", size);
        $("#title").css("font-size", size + "px");
    });
    $("#text_size_metadata").change(function () {
        var size = $("#text_size_metadata").val();
        console.log(size);
        localStorage.setItem("text_size_metadata", size);
        $("#meta").css("font-size", size + "px");
    });
    $("#text_size_review").change(function () {
        var size = $("#text_size_review").val();
        console.log(size);
        localStorage.setItem("text_size_review", size);
        $("#text").css("font-size", size + "px");
    });
    // var container_tint = localStorage.getItem("container_tint");
    // if (container_tint == null) {
    //   localStorage.setItem("container_tint", "#c4c4c4");
    // }

    // Setting default values if null
    if (localStorage.getItem("score") == null) {
      localStorage.setItem("score", "4");
    }
    if (score_one == null) {
        localStorage.setItem("quick_score_1", "Didn't Like It");
        score_one = "Didn't Like It";
    }
    if (score_two == null) {
        localStorage.setItem("quick_score_2", "Decent");
        score_two = "Decent";
    }
    if (score_three == null) {
        localStorage.setItem("quick_score_3", "Liked It");
        score_three = "Liked It";
    }
    if (score_four == null) {
        localStorage.setItem("quick_score_4", "Loved It!");
        score_four = "Loved It!";
    }
    if (score_one_color == null) {
        localStorage.setItem("quick_score_color_1", "#F28482");
        score_one = "Didn't Like It";
    }
    if (score_two_color == null) {
        localStorage.setItem("quick_score_color_2", "#F6BD60");
        score_two = "Decent";
    }
    if (score_three_color == null) {
        localStorage.setItem("quick_score_color_3", "#A4BBF4");
        score_three = "Liked It";
    }
    if (score_four_color == null) {
        localStorage.setItem("quick_score_color_4", "#05CC9E");
        score_four = "Loved It!";
    }
    if (container_background_color == null) {
        localStorage.setItem("container_background_color", "#2B384F");
        location.reload();
    }
    var accent = pSBC(-0.5, localStorage.getItem("container_background_color"));
    // console.log(accent);
    // Applying saved values to the page
    $("#poor").html(score_one);
    $("#score_1").val(score_one);
    $("#solid").html(score_two);
    $("#score_2").val(score_two);
    $("#good").html(score_three);
    $("#score_3").val(score_three);
    $("#great").html(score_four);
    $("#score_4").val(score_four);
    $("#poor_color").val(localStorage.getItem("quick_score_color_1"));
    $("#okay_color").val(localStorage.getItem("quick_score_color_2"));
    $("#good_color").val(localStorage.getItem("quick_score_color_3"));
    $("#great_color").val(localStorage.getItem("quick_score_color_4"));
    $("#background_color").val(
        localStorage.getItem("container_background_color")
    );
    $("#review").css("background-color", container_background_color);
    $("#title").css("color", localStorage.getItem("container_text_color"));
    $("#metadata").css("color", localStorage.getItem("container_text_color"));
    $("#review").css("color", localStorage.getItem("container_text_color"));
    $("#end").css("color", localStorage.getItem("container_text_color"));
    // Setting text color based on contrast ratios
    localStorage.setItem(
        "container_text_color",
        getContrastYIQ(localStorage.getItem("container_background_color"))
    );
    localStorage.setItem(
        "quick_score_text_color_1",
        getContrastYIQ(localStorage.getItem("quick_score_color_1"))
    );
    localStorage.setItem(
        "quick_score_text_color_2",
        getContrastYIQ(localStorage.getItem("quick_score_color_2"))
    );
    localStorage.setItem(
        "quick_score_text_color_3",
        getContrastYIQ(localStorage.getItem("quick_score_color_3"))
    );
    localStorage.setItem(
        "quick_score_text_color_4",
        getContrastYIQ(localStorage.getItem("quick_score_color_4"))
    );

    // Setting container background {
    $("#review").css(
        "background_color",
        localStorage.getItem("container_background_color")
    );
    // getAndSetPageBackgroundColor(localStorage.getItem("container_background_color"));
    // $("html").css(
    //   "background-color",
    //   localStorage.getItem("container_background_color")
    // );
    $("#bottom").css(
        "border-color",
        pSBC(-0.5, localStorage.getItem("container_background_color"))
    );
    if ($(window).width() < 600) {
      $("#poster").css(
        "border",
        "3px solid " + pSBC(-0.5, localStorage.getItem("container_background_color"))
      );
    } else {
      $("#poster").css(
        "border",
        "9px solid " + pSBC(-0.5, localStorage.getItem("container_background_color"))
      );
    }
});

// Setting score colors on click/tap
// Desktop
$("#poor").click(function () {
    $("#poor").css(
        "background-color",
        localStorage.getItem("quick_score_color_1")
    );
    $("#solid").css("background-color", "#f5f5f500");
    $("#good").css("background-color", "#f5f5f500");
    $("#great").css("background-color", "#f5f5f500");
    // Text Colors
    $("#poor").css("color", localStorage.getItem("quick_score_text_color_1"));
    $("#solid").css("color", localStorage.getItem("container_text_color"));
    $("#good").css("color", localStorage.getItem("container_text_color"));
    $("#great").css("color", localStorage.getItem("container_text_color"));
    // $("#poor").attr("transition-style", "in:circle:center");
    // $("#solid").removeAttr("transition-style", "in:circle:center");
    // $("#good").removeAttr("transition-style", "in:circle:center");
    // $("#great").removeAttr("transition-style", "in:circle:center");
    localStorage.setItem("score", "1");
    $("#review").queue(function () {
        $("#review").css(
            "background-color",
            localStorage.getItem("container_background_color")
        );
        $("#bottom").css(
            "border-color",
            pSBC(-0.5, localStorage.getItem("container_background_color"))
        );
    });
    $("#poor").addClass("animate__pulse");
    $("#poor").delay(200).queue(function() {
      // Code to execute after the pause
      $("#poor").removeClass("animate__pulse");
      $(this).dequeue();
    });
});
$("#solid").click(function () {
    $("#poor").css("background-color", "#f5f5f500");
    $("#solid").css(
        "background-color",
        localStorage.getItem("quick_score_color_2")
    );
    $("#good").css("background-color", "#f5f5f500");
    $("#great").css("background-color", "#f5f5f500");
    // Text Colors
    $("#poor").css("color", localStorage.getItem("container_text_color"));
    $("#solid").css("color", localStorage.getItem("quick_score_text_color_2"));
    $("#good").css("color", localStorage.getItem("container_text_color"));
    $("#great").css("color", localStorage.getItem("container_text_color"));
    // $("#poor").removeAttr("transition-style", "in:circle:center");
    // $("#solid").attr("transition-style", "in:circle:center");
    // $("#good").removeAttr("transition-style", "in:circle:center");
    // $("#great").removeAttr("transition-style", "in:circle:center");
    localStorage.setItem("score", "2");
    $("#solid").addClass("animate__pulse");
    $("#solid").delay(200).queue(function() {
      // Code to execute after the pause
      $("#solid").removeClass("animate__pulse");
      $(this).dequeue();
    });
});
$("#good").click(function () {
    $("#poor").css("background-color", "#f5f5f500");
    $("#solid").css("background-color", "#f5f5f500");
    $("#good").css(
        "background-color",
        localStorage.getItem("quick_score_color_3")
    );
    $("#great").css("background-color", "#f5f5f500");
    // Text Colors
    $("#poor").css("color", localStorage.getItem("container_text_color"));
    $("#solid").css("color", localStorage.getItem("container_text_color"));
    $("#good").css("color", localStorage.getItem("quick_score_text_color_3"));
    $("#great").css("color", localStorage.getItem("container_text_color"));
    // $("#poor").removeAttr("transition-style", "in:circle:center");
    // $("#solid").removeAttr("transition-style", "in:circle:center");
    // $("#good").attr("transition-style", "in:circle:center");
    // $("#great").removeAttr("transition-style", "in:circle:center");
    localStorage.setItem("score", "3");
    $("#good").addClass("animate__pulse");
    $("#good").delay(200).queue(function() {
      // Code to execute after the pause
      $("#good").removeClass("animate__pulse");
      $(this).dequeue();
    });
});
$("#great").click(function () {
    $("#poor").css("background-color", "#f5f5f500");
    $("#solid").css("background-color", "#f5f5f500");
    $("#good").css("background-color", "#f5f5f500");
    $("#great").css(
        "background-color",
        localStorage.getItem("quick_score_color_4")
    );
    // Text Colors
    $("#poor").css("color", localStorage.getItem("container_text_color"));
    $("#solid").css("color", localStorage.getItem("container_text_color"));
    $("#good").css("color", localStorage.getItem("container_text_color"));
    $("#great").css("color", localStorage.getItem("quick_score_text_color_4"));
    // $("#poor").removeAttr("transition-style", "in:circle:center");
    // $("#solid").removeAttr("transition-style", "in:circle:center");
    // $("#good").removeAttr("transition-style", "in:circle:center");
    // $("#great").attr("transition-style", "in:circle:center");
    localStorage.setItem("score", "4");
    $("#great").addClass("animate__pulse");
    $("#great").delay(200).queue(function() {
      // Code to execute after the pause
      $("#great").removeClass("animate__pulse");
      $(this).dequeue();
    });
});


// Reset the default scores
$("#reset_score_names_button").click(function () {
    localStorage.setItem("quick_score_1", "Didn't Like It");
    localStorage.setItem("quick_score_2", "Decent");
    localStorage.setItem("quick_score_3", "Liked It");
    localStorage.setItem("quick_score_4", "Loved It!");
    $("#poor").html("Didn't Like It");
    $("#solid").html("Decent");
    $("#good").html("Liked It");
    $("#great").html("Loved It!");
    $("#poor_mobile").html("Didn't Like It");
    $("#solid_mobile").html("Decent");
    $("#good_mobile").html("Liked It");
    $("#great_mobile").html("Loved It!");
    $("#score_1").val("Didn't Like It");
    $("#score_2").val("Decent");
    $("#score_3").val("Liked It");
    $("#score_4").val("Loved It!");
  });

  // Reset the background
  $("#reset_background_button").click(function () {
    localStorage.setItem("container_text_color", "#ffffff");
    localStorage.setItem("container_background_color", "#2B384F");
    $("#background_color").val("#2B384F");
    $("#title").css("color", localStorage.getItem("container_text_color"));
    $("#metadata").css("color", localStorage.getItem("container_text_color"));
    $("#review").css("color", localStorage.getItem("container_text_color"));
    $("#review").css(
      "background-color",
      localStorage.getItem("container_background_color")
    );
    $("#bottom").css(
      "border-color",
      pSBC(-0.5, localStorage.getItem("container_background_color"))
    );
    $("#poster").css(
      "border",
      "9px solid " + pSBC(-0.5, localStorage.getItem("container_background_color"))
    );
  });

  // Reset the colors
  $("#reset_colors_button").click(function () {
    localStorage.setItem("container_text_color", "#ffffff");
    localStorage.setItem("container_background_color", "#2B384F");
    $("#background_color").val("#2B384F");
    $("#title").css("color", localStorage.getItem("container_text_color"));
    $("#metadata").css("color", localStorage.getItem("container_text_color"));
    $("#review").css("color", localStorage.getItem("container_text_color"));
    $("#review").css(
      "background-color",
      localStorage.getItem("container_background_color")
    );
    $("#bottom").css(
      "border-color",
      pSBC(-0.5, localStorage.getItem("container_background_color"))
    );
    $("#poster").css(
      "border",
      "9px solid " + pSBC(-0.5, localStorage.getItem("container_background_color"))
    );

    localStorage.setItem("quick_score_color_1", "#E32401");
    localStorage.setItem("quick_score_color_2", "#FFF995");
    localStorage.setItem("quick_score_color_3", "#02C7FC");
    localStorage.setItem("quick_score_color_4", "#B1FC8C");
    localStorage.setItem("quick_score_text_color_1", "#000000");
    localStorage.setItem("quick_score_text_color_2", "#000000");
    localStorage.setItem("quick_score_text_color_3", "#000000");
    localStorage.setItem("quick_score_text_color_4", "#000000");
    $("#poor_color").val("#E32401");
    $("#okay_color").val("#FFF995");
    $("#good_color").val("#02C7FC");
    $("#great_color").val("#B1FC8C");
    location.reload();
  });

  // Reset the font sizes
  $("#reset_font_size_button").click(function () {
    if ($(window).width() < 600) {
      localStorage.setItem("text_size_title", "17");
      $("#title").css("font-size", "17px");
      $("#text_size_title").val("17");
      localStorage.setItem("text_size_metadata", "10");
      $("#meta").css("font-size", "10px");
      $("#text_size_metadata").val("10");
      localStorage.setItem("text_size_review", "9");
      $("#text").css("font-size", "9px");
      $("#text_size_review").val("9");
    } else {
      localStorage.setItem("text_size_title", "48");
      $("#title").css("font-size", "48px");
      $("#text_size_title").val("48");
      localStorage.setItem("text_size_metadata", "28");
      $("#meta").css("font-size", "28px");
      $("#text_size_metadata").val("28");
      localStorage.setItem("text_size_review", "26");
      $("#text").css("font-size", "26px");
      $("#text_size_review").val("26");
    }
  });



  // Save user's custom score names
  $("#score_1").change(function () {
    var score_one = $("#score_1").val();
    localStorage.setItem("quick_score_1", score_one);
    $("#poor").html(score_one);
    $("#poor_mobile").html(score_one);
  });
  $("#score_2").change(function () {
    var score_two = $("#score_2").val();
    localStorage.setItem("quick_score_2", score_two);
    $("#solid").html(score_two);
    $("#solid_mobile").html(score_two);
  });
  $("#score_3").change(function () {
    var score_three = $("#score_3").val();
    localStorage.setItem("quick_score_3", score_three);
    $("#good").html(score_three);
    $("#good_mobile").html(score_three);
  });
  $("#score_4").change(function () {
    var score_four = $("#score_4").val();
    localStorage.setItem("quick_score_4", score_four);
    $("#great").html(score_four);
    $("#great_mobile").html(score_four);
  });

  // Save user's custom colors
  $("#background_color").change(function () {
    var score_color_one = $("#background_color").val();
    // Darken color & set page background
    // getAndSetPageBackgroundColor(score_color_one);

    localStorage.setItem("container_background_color", score_color_one);
    localStorage.setItem(
      "container_text_color",
      getContrastYIQ(score_color_one)
    );
    $("#review").css(
      "background-color",
      localStorage.getItem("container_background_color")
    );
    $("#bottom").css(
      "border-color",
      pSBC(-0.5, localStorage.getItem("container_background_color"))
    );
    $("#poster").css(
      "border",
      "9px solid " + pSBC(-0.5, localStorage.getItem("container_background_color"))
    );
    $("#watermark").css(
      "color",
      pSBC(-0.7, localStorage.getItem("container_background_color"))
    );
    $("#title").css("color", localStorage.getItem("container_text_color"));
    $("#metadata").css("color", localStorage.getItem("container_text_color"));
    $("#review").css("color", localStorage.getItem("container_text_color"));
    $("#end").css("color", localStorage.getItem("container_text_color"));
  });
  $("#poor_color").change(function () {
    var score_color_one = $("#poor_color").val();
    localStorage.setItem("quick_score_color_1", score_color_one);
    localStorage.setItem(
      "quick_score_text_color_1",
      getContrastYIQ(score_color_one)
    );
    location.reload();
  });
  $("#okay_color").change(function () {
    var score_color_one = $("#okay_color").val();
    localStorage.setItem("quick_score_color_2", score_color_one);
    localStorage.setItem(
      "quick_score_text_color_2",
      getContrastYIQ(score_color_one)
    );
    location.reload();
  });
  $("#good_color").change(function () {
    var score_color_one = $("#good_color").val();
    localStorage.setItem("quick_score_color_3", score_color_one);
    localStorage.setItem(
      "quick_score_text_color_3",
      getContrastYIQ(score_color_one)
    );
    location.reload();
  });
  $("#great_color").change(function () {
    var score_color_one = $("#great_color").val();
    localStorage.setItem("quick_score_color_4", score_color_one);
    localStorage.setItem(
      "quick_score_text_color_4",
      getContrastYIQ(score_color_one)
    );
    location.reload();
  });



  function getContrastYIQ(hexcolor) {
    hexcolor = hexcolor.replace("#", "");
    var r = parseInt(hexcolor.substr(0, 2), 16);
    var g = parseInt(hexcolor.substr(2, 2), 16);
    var b = parseInt(hexcolor.substr(4, 2), 16);
    var yiq = (r * 299 + g * 587 + b * 114) / 1000;
    // console.log(yiq);
    return yiq >= 128 ? "#000000" : "#ffffff";
  }

  // pSBC Version 4.1
  const pSBC = (p, c0, c1, l) => {
    let r,
      g,
      b,
      P,
      f,
      t,
      h,
      m = Math.round,
      a = typeof c1 == "string";
    if (
      typeof p != "number" ||
      p < -1 ||
      p > 1 ||
      typeof c0 != "string" ||
      (c0[0] != "r" && c0[0] != "#") ||
      (c1 && !a)
    )
      return null;
    (h = c0.length > 9),
      (h = a ? (c1.length > 9 ? true : c1 == "c" ? !h : false) : h),
      (f = pSBC.pSBCr(c0)),
      (P = p < 0),
      (t =
        c1 && c1 != "c"
          ? pSBC.pSBCr(c1)
          : P
          ? { r: 0, g: 0, b: 0, a: -1 }
          : { r: 255, g: 255, b: 255, a: -1 }),
      (p = P ? p * -1 : p),
      (P = 1 - p);
    if (!f || !t) return null;
    if (l)
      (r = m(P * f.r + p * t.r)),
        (g = m(P * f.g + p * t.g)),
        (b = m(P * f.b + p * t.b));
    else
      (r = m((P * f.r ** 2 + p * t.r ** 2) ** 0.5)),
        (g = m((P * f.g ** 2 + p * t.g ** 2) ** 0.5)),
        (b = m((P * f.b ** 2 + p * t.b ** 2) ** 0.5));
    (a = f.a),
      (t = t.a),
      (f = a >= 0 || t >= 0),
      (a = f ? (a < 0 ? t : t < 0 ? a : a * P + t * p) : 0);
    if (h)
      return (
        "rgb" +
        (f ? "a(" : "(") +
        r +
        "," +
        g +
        "," +
        b +
        (f ? "," + m(a * 1000) / 1000 : "") +
        ")"
      );
    else
      return (
        "#" +
        (4294967296 + r * 16777216 + g * 65536 + b * 256 + (f ? m(a * 255) : 0))
          .toString(16)
          .slice(1, f ? undefined : -2)
      );
  };

  pSBC.pSBCr = (d) => {
    const i = parseInt;
    let n = d.length,
      x = {};
    if (n > 9) {
      const [r, g, b, a] = (d = d.split(","));
      n = d.length;
      if (n < 3 || n > 4) return null;
      (x.r = i(r[3] == "a" ? r.slice(5) : r.slice(4))),
        (x.g = i(g)),
        (x.b = i(b)),
        (x.a = a ? parseFloat(a) : -1);
    } else {
      if (n == 8 || n == 6 || n < 4) return null;
      if (n < 6)
        d =
          "#" +
          d[1] +
          d[1] +
          d[2] +
          d[2] +
          d[3] +
          d[3] +
          (n > 4 ? d[4] + d[4] : "");
      d = i(d.slice(1), 16);
      if (n == 9 || n == 5)
        (x.r = (d >> 24) & 255),
          (x.g = (d >> 16) & 255),
          (x.b = (d >> 8) & 255),
          (x.a = Math.round((d & 255) / 0.255) / 1000);
      else (x.r = d >> 16), (x.g = (d >> 8) & 255), (x.b = d & 255), (x.a = -1);
    }
    return x;
  };

  // Darken color & set page background
  function getAndSetPageBackgroundColor(reviewBackground) {
    console.log("Function called with " + reviewBackground);
    var color = tinycolor(reviewBackground);
    color = color.lighten(60); // 10% darker
    color = color.desaturate(10); // 10% less saturation
    color = color.toHexString();
    $("html").css(
      "background-color",
      color
    );
    console.log("HTML set to " + color);
  }

  $(document).ready(function(){
    // If the banner hasn't been dismissed before, show it
    if (!localStorage.getItem("iosBannerDismissed")) {
      $("#ios-banner").addClass("show");
    }

    // When the user clicks the dismiss button, hide the banner and set the flag
    $("#close-ios-banner").click(function(){
      $("#ios-banner").removeClass("show");
      localStorage.setItem("iosBannerDismissed", "true");
    });

    // Size button controls
    $(".size-decrease").click(function() {
      var targetId = $(this).data("target");
      var input = $("#" + targetId);
      var currentVal = parseInt(input.val()) || 0;
      var minVal = parseInt(input.attr("min")) || 8;
      if (currentVal > minVal) {
        input.val(currentVal - 1).trigger("change");
      }
    });

    $(".size-increase").click(function() {
      var targetId = $(this).data("target");
      var input = $("#" + targetId);
      var currentVal = parseInt(input.val()) || 0;
      var maxVal = parseInt(input.attr("max")) || 120;
      if (currentVal < maxVal) {
        input.val(currentVal + 1).trigger("change");
      }
    });

    // Update background color hex display
    function updateColorValue() {
      var colorVal = $("#background_color").val();
      $("#background_color_value").text(colorVal.toUpperCase());
    }
    updateColorValue();
    $("#background_color").on("input change", updateColorValue);

    // Update label indicators to match score colors
    function updateLabelIndicators() {
      var poorColor = localStorage.getItem("quick_score_color_1") || "#F28482";
      var okayColor = localStorage.getItem("quick_score_color_2") || "#F6BD60";
      var goodColor = localStorage.getItem("quick_score_color_3") || "#A4BBF4";
      var greatColor = localStorage.getItem("quick_score_color_4") || "#05CC9E";

      $(".label-item:nth-child(1) .label-indicator").css("background", poorColor);
      $(".label-item:nth-child(2) .label-indicator").css("background", okayColor);
      $(".label-item:nth-child(3) .label-indicator").css("background", goodColor);
      $(".label-item:nth-child(4) .label-indicator").css("background", greatColor);
    }
    updateLabelIndicators();

    // Vertical text size slider
    var textSlider = $("#text_size_slider");
    var sliderDisplay = $("#slider_value_display");

    // Initialize slider with current value
    var currentSize = localStorage.getItem("text_size_review") || "26";
    textSlider.val(currentSize);
    sliderDisplay.text(currentSize);

    // Update on slider input (real-time as user drags)
    textSlider.on("input", function() {
      var size = $(this).val();
      sliderDisplay.text(size);
      $("#text").css("font-size", size + "px");
    });

    // Save to localStorage when user releases slider
    textSlider.on("change", function() {
      var size = $(this).val();
      localStorage.setItem("text_size_review", size);
      $("#text_size_review").val(size); // Sync with panel input
    });

    // Sync slider when panel input changes
    $("#text_size_review").on("change", function() {
      var size = $(this).val();
      textSlider.val(size);
      sliderDisplay.text(size);
    });
  });

</script>
